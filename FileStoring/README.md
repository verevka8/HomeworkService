# HomeworkService

## Архитектура
- **FileStoring (порт 8081 в docker-compose)** – получает запросы на создание пользователей и загрузку домашних заданий. Метаданные пользователей и домашних заданий сохраняются в PostgreSQL, файлы кладутся в Yandex Object Storage (S3 API). После загрузки инициирует анализ через REST-вызов в сервис FileAnalysis. Конфигурация S3 и базового URL анализа задаётся через `application.properties` и переменные окружения `.env`.
- **FileAnalysis (порт 8080)** – подтягивает исходный файл задания из S3, генерирует облако слов через внешний сервис QuickChart, выполняет проверку на плагиат и сохраняет результаты в БД. Отдаёт отчёты по задаче и принимает вызов на запуск анализа конкретного задания.
- **Инфраструктура** – оба сервиса используют общий Postgres-кластер (docker-compose service `db`) и один бакет S3. Взаимодействие между сервисами синхронное (HTTP), внешние интеграции – REST-клиентом к FileAnalysis и QuickChart.

## Пользовательские сценарии и технические потоки
1. **Создание пользователя**
    1. Клиент отправляет запрос `POST /api/users` в FileStoring. Контроллер `UserController` вызывает доменный сервис пользователей, который сохраняет сущность в БД через JPA-репозиторий.
2. **Загрузка домашнего задания**
    1. Клиент отправляет `POST /api/homework` (multipart: метаданные + файл) в FileStoring.
    2. `HomeworkController` валидирует части запроса и прокидывает их в `HomeworkService`.
    3. `HomeworkService` сохраняет метаданные задания в Postgres, отправляет сам файл в S3 (`YandexS3HomeworkStorage`), после чего делает REST-вызов `GET {FILEANALYSIS_URL}/api/analysis_homework?homeworkId={id}` через `RestTemplate`.
3. **Запуск анализа в FileAnalysis**
    1. Контроллер `HomeworkController` (FileAnalysis) принимает вызов анализа по `homeworkId`.
    2. `HomeworkAnalysisService` загружает текст задания из S3, формирует облако слов через `WordCloudClient` (QuickChart), сохраняет изображение обратно в S3 и сравнивает текст с другими решениями той же задачи.
    3. Найденные пары подозрительных пользователей сохраняются в таблице плагиата для дальнейшей выдачи отчётов.
4. **Получение отчёта по задаче**
    1. Клиент запрашивает `GET /api/homeworks/{task}/report` у FileAnalysis.
    2. Сервис собирает группы возможных плагиаторов по задаче и возвращает структуру `ReportResponse` с разбивкой по группам пользователей.

## Запуск локально
- Заполните `.env` по образцу `example.env` (S3, база, URL анализа).
- Запустите стек: `docker-compose up --build` (поднимет Postgres, FileStoring на 8081 и FileAnalysis на 8080).
- Swagger UI доступен в FileStoring на `/swagger-ui.html` и агрегирует спецификации обоих сервисов.
